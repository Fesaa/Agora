"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[501],{8453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>t});var s=o(6540);const l={},r=s.createContext(l);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},9298:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"dev/local-open-id-connect","title":"Locally hosted OpenId Connect server","description":"Agora requires you to set up an OpenId Connect provider,","source":"@site/docs/dev/local-open-id-connect.md","sourceDirName":"dev","slug":"/dev/local-open-id-connect","permalink":"/Agora/docs/dev/local-open-id-connect","draft":false,"unlisted":false,"editUrl":"https://github.com/Fesaa/Agora/tree/master/UI/documentation/docs/dev/local-open-id-connect.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Contributing","permalink":"/Agora/docs/dev/contributing"}}');var l=o(4848),r=o(8453);const i={},t="Locally hosted OpenId Connect server",c={},a=[{value:"KeyCloak",id:"keycloak",level:2},{value:"Setup",id:"setup",level:3},{value:"Others",id:"others",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"locally-hosted-openid-connect-server",children:"Locally hosted OpenId Connect server"})}),"\n",(0,l.jsx)(n.p,{children:"Agora requires you to set up an OpenId Connect provider,\nthis is also true for development as local account are not a thing."}),"\n",(0,l.jsxs)(n.p,{children:["While you can set up any you want, as long as it follows the structure as explained ",(0,l.jsx)(n.a,{href:"../guides/open-id-connect",children:"here"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"keycloak",children:"KeyCloak"}),"\n",(0,l.jsx)(n.p,{children:"We've used a keycloak (dev) instance in docker during development."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'services:\n  keycloak:\n    image: quay.io/keycloak/keycloak\n    container_name: keycloak\n    environment:\n      - KEYCLOAK_ADMIN=admin\n      - KEYCLOAK_ADMIN_PASSWORD=admin\n      - KEYCLOAK_HTTP_PORT=8080\n    ports:\n      - "8080:8080"\n    command:\n      - start-dev\n    volumes:\n      - keycloak_h2_data:/opt/keycloak/data/\n    restart: always\n\nvolumes:\n  keycloak_h2_data:\n'})}),"\n",(0,l.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,l.jsx)(n.p,{children:"With the following setup steps,"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Loging (admin, admin)"}),"\n",(0,l.jsx)(n.li,{children:"Create new realm"}),"\n",(0,l.jsxs)(n.li,{children:["Create agora client","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"LEAVE client auth off"}),"\n",(0,l.jsxs)(n.li,{children:["root: ",(0,l.jsx)(n.a,{href:"http://localhost:4200",children:"http://localhost:4200"})]}),"\n",(0,l.jsxs)(n.li,{children:["redirect: ",(0,l.jsx)(n.a,{href:"http://localhost:4200/callback",children:"http://localhost:4200/callback"})]}),"\n",(0,l.jsxs)(n.li,{children:["origin: ",(0,l.jsx)(n.a,{href:"http://localhost:4200",children:"http://localhost:4200"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Create api client (id must be ",(0,l.jsx)(n.code,{children:"agora-api"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:["Create client scope","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["name doesn't matter, I use ",(0,l.jsx)(n.code,{children:"agora-api-audience"})]}),"\n",(0,l.jsxs)(n.li,{children:["add mapper","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"by configuration"}),"\n",(0,l.jsx)(n.li,{children:"audience"}),"\n",(0,l.jsxs)(n.li,{children:["name: ",(0,l.jsx)(n.code,{children:"agora-api"})," (can be whatever)"]}),"\n",(0,l.jsxs)(n.li,{children:["include Client Audience: ",(0,l.jsx)(n.code,{children:"agora-api"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["In ",(0,l.jsx)(n.code,{children:"agora"})," client","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Client scopes"}),"\n",(0,l.jsx)(n.li,{children:"Add client scope"}),"\n",(0,l.jsx)(n.li,{children:"Select agora-api-audience"}),"\n",(0,l.jsx)(n.li,{children:"Set default"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Choose ",(0,l.jsx)(n.code,{children:"KeyCloak"})," as provider, and set url to ",(0,l.jsx)(n.code,{children:"http://localhost:8080/realms/dev-realm"})," on first setup screen"]}),"\n",(0,l.jsxs)(n.li,{children:["Roles for authorization","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["In ",(0,l.jsx)(n.code,{children:"agora-api"})," client -> roles"]}),"\n",(0,l.jsxs)(n.li,{children:["Add wanted roles -> See ",(0,l.jsx)(n.a,{href:"../guides/roles-and-permissions",children:"Roles and permissions"})]}),"\n",(0,l.jsx)(n.li,{children:"To your user, add the role"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"others",children:"Others"}),"\n",(0,l.jsxs)(n.p,{children:["As mentioned above, other providers should work fine if they include roles like ",(0,l.jsx)(n.code,{children:"KeyCloak"})," or ",(0,l.jsx)(n.code,{children:"Azure"})," in the JWT token.\nYou can find the ClaimsTransformers ",(0,l.jsx)(n.a,{href:"https://github.com/Fesaa/Agora/tree/master/API/Helpers/RoleClaimTransformers",children:"here"}),". If you've got a working configuration; don't hesitate to edit this page."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);